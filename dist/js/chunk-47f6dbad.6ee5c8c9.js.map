{"version":3,"sources":["webpack:///./src/views/user-manage/components/Export2ExcelConstants.js","webpack:///./src/views/user-manage/components/Export2Excel.vue","webpack:///./src/views/user-manage/components/Export2Excel.vue?c649","webpack:///./src/views/user-manage/index.vue","webpack:///./src/views/user-manage/index.vue?6f63","webpack:///./src/views/user-manage/index.vue?83ad","webpack:///./src/api/user-manage.js","webpack:///./node_modules/core-js/modules/es.array.map.js"],"names":["USER_RELATIONS","姓名","联系方式","角色","开通时间","i18n","excelName","t","value","closed","emits","loading","onConfirm","allUserList","list","excel","data","formatJson","export_json_to_excel","header","Object","keys","filename","console","log","headers","rows","map","item","key","roles","JSON","stringify","role","title","__exports__","tableData","total","page","size","getListData","res","handleSizeChange","currentSize","handleCurrentChange","currentPage","router","onImportExcelClick","push","exportToExcelVisible","onToExcel","onShowClick","id","onRemoveClick","row","confirm","username","type","then","_id","success","getUserManageList","request","url","params","getUserManageAllList","userDetail","userBatchImport","method","deleteUser","$","$map","arrayMethodHasSpeciesSupport","HAS_SPECIES_SUPPORT","target","proto","forced","callbackfn","this","arguments","length","undefined"],"mappings":"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","file":"js/chunk-47f6dbad.6ee5c8c9.js","sourcesContent":["export const USER_RELATIONS = {\r\n  姓名: 'username',\r\n  联系方式: 'mobile',\r\n  角色: 'role',\r\n  开通时间: 'openTime'\r\n}\r\n","<script setup>\r\nimport { ref, defineProps, defineEmits } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { watchSwitchLang } from '@/utils/i18n'\r\nimport { getUserManageAllList } from '@/api/user-manage'\r\nimport { USER_RELATIONS } from './Export2ExcelConstants'\r\nimport { dateFilter } from '@/filters'\r\n\r\nconst emits = defineEmits(['update:modelValue'])\r\n\r\ndefineProps({\r\n  modelValue: {\r\n    type: Boolean,\r\n    required: true\r\n  }\r\n})\r\n\r\n// 导出文件名\r\nconst i18n = useI18n()\r\nconst excelName = ref(i18n.t('msg.excel.defaultName'))\r\nwatchSwitchLang(() => {\r\n  excelName.value = i18n.t('msg.excel.defaultName')\r\n})\r\n\r\n// 关闭\r\nconst closed = () => {\r\n  emits('update:modelValue', false)\r\n}\r\n\r\n// 确定导出\r\nconst loading = ref(false)\r\nconst onConfirm = async () => {\r\n  loading.value = true\r\n  // 获取数据\r\n  const { list: allUserList } = await getUserManageAllList()\r\n  // 导入工具包\r\n  const excel = await import('@/utils/Export2Excel')\r\n  const data = formatJson(USER_RELATIONS, allUserList)\r\n  excel.export_json_to_excel({\r\n    header: Object.keys(USER_RELATIONS),\r\n    data,\r\n    filename: excelName.value\r\n  })\r\n  console.log(data)\r\n  closed()\r\n}\r\n\r\nconst formatJson = (headers, rows) => {\r\n  return rows.map((item) => {\r\n    return Object.keys(headers).map((key) => {\r\n      // 'role' 需要特殊处理\r\n      if (headers[key] === 'role') {\r\n        const roles = item[headers[key]]\r\n        return JSON.stringify(roles.map((role) => role.title))\r\n      }\r\n      // 时间\r\n      if (headers[key] === 'openTime') {\r\n        return dateFilter(item[headers[key]])\r\n      }\r\n      return item[headers[key]]\r\n    })\r\n  })\r\n}\r\n</script>\r\n\r\n<template>\r\n  <el-dialog\r\n    :title=\"$t('msg.excel.title')\"\r\n    :model-value=\"modelValue\"\r\n    @close=\"closed\"\r\n    width=\"30%\"\r\n  >\r\n    <el-input\r\n      v-model=\"excelName\"\r\n      :placeholder=\"$t('msg.excel.placeholder')\"\r\n    ></el-input>\r\n\r\n    <template #footer>\r\n      <div class=\"dialog-footer\">\r\n        <el-button @click=\"closed\">{{ $t('msg.excel.close') }}</el-button>\r\n        <el-button type=\"primary\" :loading=\"loading\" @click=\"onConfirm\">{{\r\n          $t('msg.excel.confirm')\r\n        }}</el-button>\r\n      </div>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n","import script from \"./Export2Excel.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Export2Excel.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","<script setup>\r\nimport { ref, onActivated } from 'vue'\r\nimport { getUserManageList, deleteUser } from '@/api/user-manage'\r\nimport { watchSwitchLang } from '@/utils/i18n'\r\nimport { useRouter } from 'vue-router'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport { useI18n } from 'vue-i18n'\r\nimport Export2Excel from './components/Export2Excel.vue'\r\n\r\n// 数据相关\r\nconst tableData = ref([])\r\nconst total = ref(0)\r\nconst page = ref(1)\r\nconst size = ref(2)\r\n\r\n// 获取数据\r\nconst getListData = async () => {\r\n  const res = await getUserManageList({\r\n    page: page.value,\r\n    size: size.value\r\n  })\r\n  tableData.value = res.list\r\n  total.value = res.total\r\n}\r\n\r\ngetListData()\r\nwatchSwitchLang(getListData)\r\n\r\nconst handleSizeChange = (currentSize) => {\r\n  size.value = currentSize\r\n  getListData()\r\n}\r\nconst handleCurrentChange = (currentPage) => {\r\n  page.value = currentPage\r\n  getListData()\r\n}\r\n\r\n// excel 导入按钮点击事件\r\nconst router = useRouter()\r\nconst onImportExcelClick = () => {\r\n  router.push('/user/import')\r\n}\r\n\r\n// excel 导出按钮点击事件\r\nconst exportToExcelVisible = ref(false)\r\nconst onToExcel = () => {\r\n  exportToExcelVisible.value = true\r\n}\r\n\r\n// 查看按钮 点击事件\r\nconst onShowClick = (id) => {\r\n  router.push(`/user/info/${id}`)\r\n}\r\n\r\n// 删除用户\r\nconst i18n = useI18n()\r\nconst onRemoveClick = (row) => {\r\n  ElMessageBox.confirm(\r\n    i18n.t('msg.excel.dialogTitle1') +\r\n      row.username +\r\n      i18n.t('msg.excel.dialogTitle2'),\r\n    {\r\n      type: 'warning'\r\n    }\r\n  ).then(async () => {\r\n    console.log(row)\r\n    await deleteUser(row._id)\r\n    ElMessage.success(i18n.t('msg.excel.removeSuccess'))\r\n    getListData()\r\n  })\r\n}\r\n\r\nonActivated(getListData)\r\n</script>\r\n\r\n<template>\r\n  <div class=\"container\">\r\n    <el-card class=\"header\">\r\n      <div>\r\n        <el-button type=\"primary\" @click=\"onImportExcelClick\">{{\r\n          $t('msg.excel.importExcel')\r\n        }}</el-button>\r\n        <el-button type=\"success\" @click=\"onToExcel\">{{\r\n          $t('msg.excel.exportExcel')\r\n        }}</el-button>\r\n      </div>\r\n    </el-card>\r\n    <el-card class=\"content\">\r\n      <el-table :data=\"tableData\" border stripe style=\"width: 100%\">\r\n        <el-table-column type=\"index\" label=\"#\" />\r\n        <el-table-column prop=\"username\" :label=\"$t('msg.excel.name')\" />\r\n        <el-table-column prop=\"mobile\" :label=\"$t('msg.excel.mobile')\" />\r\n        <el-table-column :label=\"$t('msg.excel.avatar')\" align=\"center\">\r\n          <template v-slot=\"{ row }\">\r\n            <el-image\r\n              class=\"avatar\"\r\n              :src=\"row.avatar\"\r\n              :preview-src-list=\"[row.avatar]\"\r\n            />\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('msg.excel.role')\">\r\n          <template v-slot=\"{ row }\">\r\n            <div v-if=\"row?.role?.length > 0\">\r\n              <el-tag v-for=\"item in row.role\" :key=\"item.id\" size=\"mini\">\r\n                {{ item.title }}\r\n              </el-tag>\r\n            </div>\r\n            <div v-else>\r\n              <el-tag size=\"mini\">{{ $t('msg.excel.defaultRole') }}</el-tag>\r\n            </div>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column :label=\"$t('msg.excel.openTime')\">\r\n          <template #default=\"{ row }\">\r\n            {{ $filters.dateFilter(row.openTime) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column\r\n          :label=\"$t('msg.excel.action')\"\r\n          fixed=\"right\"\r\n          width=\"300\"\r\n        >\r\n          <template #default=\"{ row }\">\r\n            <el-button\r\n              type=\"primary\"\r\n              size=\"mini\"\r\n              @click=\"onShowClick(row._id)\"\r\n              >{{ $t('msg.excel.show') }}</el-button\r\n            >\r\n            <el-button type=\"info\" size=\"mini\">{{\r\n              $t('msg.excel.showRole')\r\n            }}</el-button>\r\n            <el-button type=\"danger\" size=\"mini\" @click=\"onRemoveClick(row)\">{{\r\n              $t('msg.excel.remove')\r\n            }}</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <el-pagination\r\n        class=\"pagination\"\r\n        :total=\"total\"\r\n        :page-size=\"size\"\r\n        :page-sizes=\"[2, 5, 10, 20]\"\r\n        :current-page=\"page\"\r\n        @size-change=\"handleSizeChange\"\r\n        @current-change=\"handleCurrentChange\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\"\r\n      ></el-pagination>\r\n    </el-card>\r\n\r\n    <export2-excel v-model=\"exportToExcelVisible\"></export2-excel>\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n.container {\r\n  .header {\r\n    margin-bottom: 22px;\r\n    text-align: right;\r\n  }\r\n\r\n  .content {\r\n    :deep(.avatar) {\r\n      width: 60px;\r\n      height: 60px;\r\n      border-radius: 50%;\r\n    }\r\n\r\n    :deep(.el-tag) {\r\n      margin-right: 6px;\r\n    }\r\n    .pagination {\r\n      margin-top: 20px;\r\n      text-align: center;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=a2523bd2&lang=scss&scoped=true\"\n\nimport exportComponent from \"E:\\\\项目\\\\后台管理项目\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-a2523bd2\"]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=a2523bd2&lang=scss&scoped=true\"","import request from '@/utils/request'\r\n\r\n/**\r\n * @description 获取用户列表数据\r\n * @date 04/12/2021\r\n * @param {*} data\r\n * @return {*}\r\n */\r\nexport const getUserManageList = (data) => {\r\n  return request({\r\n    url: '/user-manage/list',\r\n    params: data\r\n  })\r\n}\r\n\r\n/**\r\n * @description 获取所有用户列表数据\r\n * @date 05/12/2021\r\n * @return {*}\r\n */\r\nexport const getUserManageAllList = () => {\r\n  return request({\r\n    url: '/user-manage/all-list'\r\n  })\r\n}\r\n\r\n/**\r\n * @description 获取指定用户详情\r\n * @date 09/12/2021\r\n * @return {*}\r\n */\r\nexport const userDetail = (id) => {\r\n  return request({\r\n    url: `/user-manage/detail/${id}`\r\n  })\r\n}\r\n\r\n/**\r\n * @description 批量上传\r\n * @date 04/12/2021\r\n * @param {*} data\r\n * @return {*}\r\n */\r\nexport const userBatchImport = (data) => {\r\n  return request({\r\n    url: '/user-manage/batch/import',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\n/**\r\n * @description 删除指定数据\r\n * @date 05/12/2021\r\n * @param {*} id\r\n */\r\nexport const deleteUser = (id) => {\r\n  return request({\r\n    url: `/user-manage/detele/${id}`\r\n  })\r\n}\r\n","'use strict';\nvar $ = require('../internals/export');\nvar $map = require('../internals/array-iteration').map;\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('map');\n\n// `Array.prototype.map` method\n// https://tc39.es/ecma262/#sec-array.prototype.map\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT }, {\n  map: function map(callbackfn /* , thisArg */) {\n    return $map(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n"],"sourceRoot":""}