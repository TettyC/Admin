{"version":3,"sources":["webpack:///./src/components/UploadExcel/index.vue?5244","webpack:///./src/api/user-manage.js","webpack:///./src/views/import/utils.js","webpack:///./node_modules/@element-plus/icons/es/UploadFilled.js","webpack:///./src/components/UploadExcel/utils.js","webpack:///./src/components/UploadExcel/index.vue","webpack:///./src/components/UploadExcel/index.vue?68e2","webpack:///./src/views/import/index.vue","webpack:///./src/views/import/index.vue?4803"],"names":["getUserManageList","data","request","url","params","getUserManageAllList","userDetail","id","userBatchImport","method","deleteUser","USER_RELATIONS","姓名","联系方式","角色","开通时间","formatData","numb","time","Date","setFullYear","getFullYear","year","month","getMonth","date","getDate","script","name","_hoisted_1","xmlns","viewBox","_hoisted_2","fill","d","render","_ctx","_cache","$props","$setup","$data","$options","__file","getHeaderRow","sheet","C","headers","range","XLSX","utils","decode_range","R","s","r","c","e","cell","encode_cell","hdr","t","format_cell","push","isExcel","file","test","loading","excelUploadInput","handleUpload","value","click","handleChange","files","target","rawFile","upload","handleDrop","dataTransfer","length","error","handleDragover","dropEffect","props","beforeUpload","before","parseData","Promise","resolve","reject","reader","FileReader","onload","result","workbook","read","type","firstSheetName","SheetNames","workSheet","Sheets","header","results","sheet_to_json","generateData","readAsArrayBuffer","excelData","onSuccess","__exports__","i18n","router","updateData","success","arr","forEach","item","userInfo","Object","keys","key"],"mappings":"2IAAA,W,oCCAA,0LAQaA,EAAoB,SAACC,GAChC,OAAOC,eAAQ,CACbC,IAAK,oBACLC,OAAQH,KASCI,EAAuB,WAClC,OAAOH,eAAQ,CACbC,IAAK,2BASIG,EAAa,SAACC,GACzB,OAAOL,eAAQ,CACbC,IAAK,uBAAF,OAAyBI,MAUnBC,EAAkB,SAACP,GAC9B,OAAOC,eAAQ,CACbC,IAAK,4BACLM,OAAQ,OACRR,UASSS,EAAa,SAACH,GACzB,OAAOL,eAAQ,CACbC,IAAK,uBAAF,OAAyBI,O,+GC1DnBI,EAAiB,CAC5BC,KAAI,WACJC,OAAM,SACNC,KAAI,OACJC,OAAM,YAGKC,EAAa,SAACC,GACzB,IAAMC,EAAO,IAAIC,KAAkB,IAAZF,EAAO,GAAU,KAAU,GAClDC,EAAKE,YAAYF,EAAKG,cAAgB,IACtC,IAAMC,EAAOJ,EAAKG,cAAgB,GAC5BE,EAAQL,EAAKM,WAAa,EAAI,GAC9BC,EAAOP,EAAKQ,UAAY,EAAI,GAElC,OACEJ,EACA,KACCC,EAAQ,GAAK,IAAMA,EAAQA,GAC5B,KACCE,EAAO,GAAK,IAAMA,EAAOA,I,iCCjB1BE,EAAS,6BAAgB,CAC3BC,KAAM,iBAGR,MAAMC,EAAa,CACjBC,MAAO,6BACPC,QAAS,iBAELC,EAA6B,yBAAY,OAAQ,CACrDC,KAAM,eACNC,EAAG,wTACF,MAAO,GACV,SAASC,EAAOC,EAAMC,EAAQC,EAAQC,EAAQC,EAAOC,GACnD,OAAO,yBAAa,yBAAY,MAAOZ,EAAY,CACjDG,IAIJL,EAAOQ,OAASA,EAChBR,EAAOe,OAAS,uCAED,QCrBFC,G,8BAAe,SAACC,GAC3B,IAEIC,EAFEC,EAAU,GACVC,EAAQC,IAAKC,MAAMC,aAAaN,EAAM,SAEtCO,EAAIJ,EAAMK,EAAEC,EAElB,IAAKR,EAAIE,EAAMK,EAAEE,EAAGT,EAAIE,EAAMQ,EAAED,IAAKT,EAAG,CACtC,IAAMW,EAAOZ,EAAMI,IAAKC,MAAMQ,YAAY,CAAEH,EAAGT,EAAGQ,EAAGF,KACjDO,EAAM,UAAYb,EACtB,OAAIW,QAAJ,IAAIA,KAAMG,IACRD,EAAMV,IAAKC,MAAMW,YAAYJ,IAE/BV,EAAQe,KAAKH,GAGf,OAAOZ,IAGIgB,EAAU,SAACC,GACtB,MAAO,oBAAoBC,KAAKD,EAAKnC,O,uJCVjCqC,EAAU,kBAAI,GACdC,EAAmB,iBAAI,MAEvBC,EAAe,WACnBD,EAAiBE,MAAMC,SAEnBC,EAAe,SAACf,GACpB,IAAMgB,EAAQhB,EAAEiB,OAAOD,MACjBE,EAAUF,EAAM,GACjBE,GAGLC,EAAOD,IAIHE,EAAa,SAACpB,GAClB,IAAIU,EAAQG,MAAZ,CAGA,IAAMG,EAAQhB,EAAEqB,aAAaL,MAC7B,GAAqB,IAAjBA,EAAMM,OAAV,CAIA,IAAMJ,EAAUF,EAAM,GACjBT,EAAQW,GAIbC,EAAOD,GAHL,OAAUK,MAAM,gCALhB,OAAUA,MAAM,cAWdC,EAAiB,SAACxB,GACtBA,EAAEqB,aAAaI,WAAa,QAIxBN,EAAS,SAACX,GAGd,GAFAG,EAAiBE,MAAMA,MAAQ,KAE1Ba,EAAMC,aAAX,CAKA,IAAMC,EAASF,EAAMC,aAAanB,GAC9BoB,GACFC,EAAUrB,QANVqB,EAAUrB,IAWRqB,EAAY,SAACrB,GAEjB,OADAE,EAAQG,OAAQ,EACT,IAAIiB,SAAQ,SAACC,EAASC,GAC3B,IAAMC,EAAS,IAAIC,WAGnBD,EAAOE,OAAS,SAACnC,GAEf,IAAMtD,EAAOsD,EAAEiB,OAAOmB,OAEhBC,EAAW,IAAKC,KAAK5F,EAAM,CAAE6F,KAAM,UAEnCC,EAAiBH,EAASI,WAAW,GAErCC,EAAYL,EAASM,OAAOH,GAE5BI,EAAS,EAAaF,GAEtBG,EAAU,IAAKnD,MAAMoD,cAAcJ,GAEzCK,EAAa,CAAEH,SAAQC,YAEvBnC,EAAQG,OAAQ,EAEhBkB,KAGFE,EAAOe,kBAAkBxC,OAKvBuC,EAAe,SAACE,GACpBvB,EAAMwB,WAAaxB,EAAMwB,UAAUD,I,2iCC3FrC,MAAME,EAA2B,IAAgB,EAAQ,CAAC,CAAC,YAAY,qBAExD,Q,6CCAf,IAAMC,EAAO,iBACPC,EAAS,iBACTH,EAAS,yDAAG,8GAASL,EAAT,EAASA,QACnBS,EAAaP,EAAaF,GADhB,SAEV,eAAgBS,GAFN,OAGhB,OAAUC,QAAQV,EAAQvB,OAAS8B,EAAKhD,EAAE,4BAC1CiD,EAAO/C,KAAK,gBAJI,2CAAH,sDAOTyC,EAAe,SAACF,GACpB,IAAMW,EAAM,GAeZ,OAdAX,EAAQY,SAAQ,SAACC,GACf,IAAMC,EAAW,GAEjBC,OAAOC,KAAKH,GAAMD,SAAQ,SAACK,GACG,aAAxB1G,EAAe0G,GAInBH,EAASvG,EAAe0G,IAAQJ,EAAKI,GAHnCH,EAASvG,EAAe0G,IAAQrG,EAAWiG,EAAKI,OAMpDN,EAAIlD,KAAKqD,MAGJH,G,kGC9BT,MAAM,EAAc,EAEL","file":"js/chunk-60478557.2e62a42c.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=431ff7c6&lang=scss&scoped=true\"","import request from '@/utils/request'\r\n\r\n/**\r\n * @description 获取用户列表数据\r\n * @date 04/12/2021\r\n * @param {*} data\r\n * @return {*}\r\n */\r\nexport const getUserManageList = (data) => {\r\n  return request({\r\n    url: '/user-manage/list',\r\n    params: data\r\n  })\r\n}\r\n\r\n/**\r\n * @description 获取所有用户列表数据\r\n * @date 05/12/2021\r\n * @return {*}\r\n */\r\nexport const getUserManageAllList = () => {\r\n  return request({\r\n    url: '/user-manage/all-list'\r\n  })\r\n}\r\n\r\n/**\r\n * @description 获取指定用户详情\r\n * @date 09/12/2021\r\n * @return {*}\r\n */\r\nexport const userDetail = (id) => {\r\n  return request({\r\n    url: `/user-manage/detail/${id}`\r\n  })\r\n}\r\n\r\n/**\r\n * @description 批量上传\r\n * @date 04/12/2021\r\n * @param {*} data\r\n * @return {*}\r\n */\r\nexport const userBatchImport = (data) => {\r\n  return request({\r\n    url: '/user-manage/batch/import',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\n/**\r\n * @description 删除指定数据\r\n * @date 05/12/2021\r\n * @param {*} id\r\n */\r\nexport const deleteUser = (id) => {\r\n  return request({\r\n    url: `/user-manage/detele/${id}`\r\n  })\r\n}\r\n","export const USER_RELATIONS = {\r\n  姓名: 'username',\r\n  联系方式: 'mobile',\r\n  角色: 'role',\r\n  开通时间: 'openTime'\r\n}\r\n\r\nexport const formatData = (numb) => {\r\n  const time = new Date((numb - 1) * 24 * 3600000 + 1)\r\n  time.setFullYear(time.getFullYear() - 70)\r\n  const year = time.getFullYear() + ''\r\n  const month = time.getMonth() + 1 + ''\r\n  const date = time.getDate() - 1 + ''\r\n\r\n  return (\r\n    year +\r\n    '-' +\r\n    (month < 10 ? '0' + month : month) +\r\n    '-' +\r\n    (date < 10 ? '0' + date : date)\r\n  )\r\n}\r\n","import { defineComponent, openBlock, createBlock, createVNode } from 'vue';\n\nvar script = defineComponent({\n  name: \"UploadFilled\"\n});\n\nconst _hoisted_1 = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 1024 1024\"\n};\nconst _hoisted_2 = /* @__PURE__ */ createVNode(\"path\", {\n  fill: \"currentColor\",\n  d: \"M544 864V672h128L512 480 352 672h128v192H320v-1.6c-5.376.32-10.496 1.6-16 1.6A240 240 0 0 1 64 624c0-123.136 93.12-223.488 212.608-237.248A239.808 239.808 0 0 1 512 192a239.872 239.872 0 0 1 235.456 194.752c119.488 13.76 212.48 114.112 212.48 237.248a240 240 0 0 1-240 240c-5.376 0-10.56-1.28-16-1.6v1.6H544z\"\n}, null, -1);\nfunction render(_ctx, _cache, $props, $setup, $data, $options) {\n  return openBlock(), createBlock(\"svg\", _hoisted_1, [\n    _hoisted_2\n  ]);\n}\n\nscript.render = render;\nscript.__file = \"packages/components/UploadFilled.vue\";\n\nexport default script;\n","import XLSX from 'xlsx'\r\n\r\nexport const getHeaderRow = (sheet) => {\r\n  const headers = []\r\n  const range = XLSX.utils.decode_range(sheet['!ref'])\r\n  let C\r\n  const R = range.s.r\r\n\r\n  for (C = range.s.c; C < range.e.c; ++C) {\r\n    const cell = sheet[XLSX.utils.encode_cell({ c: C, r: R })]\r\n    let hdr = 'UNKNOWN' + C\r\n    if (cell?.t) {\r\n      hdr = XLSX.utils.format_cell(cell)\r\n    }\r\n    headers.push(hdr)\r\n  }\r\n\r\n  return headers\r\n}\r\n\r\nexport const isExcel = (file) => {\r\n  return /\\.(xlsx|xls|csv)$/.test(file.name)\r\n}\r\n","<script setup>\r\nimport { ref, defineProps } from 'vue'\r\nimport XLSX from 'xlsx'\r\nimport { UploadFilled } from '@element-plus/icons'\r\nimport { getHeaderRow, isExcel } from './utils'\r\nimport { ElMessage } from 'element-plus'\r\nconst props = defineProps({\r\n  beforeUpload: Function,\r\n  onSuccess: Function\r\n})\r\n\r\nconst loading = ref(false)\r\nconst excelUploadInput = ref(null)\r\n\r\nconst handleUpload = () => {\r\n  excelUploadInput.value.click()\r\n}\r\nconst handleChange = (e) => {\r\n  const files = e.target.files\r\n  const rawFile = files[0]\r\n  if (!rawFile) {\r\n    return\r\n  }\r\n  upload(rawFile)\r\n}\r\n\r\n// 拖拽上传事件\r\nconst handleDrop = (e) => {\r\n  if (loading.value) {\r\n    return\r\n  }\r\n  const files = e.dataTransfer.files\r\n  if (files.length !== 1) {\r\n    ElMessage.error('必须上传一个文件')\r\n    return\r\n  }\r\n  const rawFile = files[0]\r\n  if (!isExcel(rawFile)) {\r\n    ElMessage.error('必须是.xlsx、.xls、.csv格式的文件')\r\n    return\r\n  }\r\n  upload(rawFile)\r\n}\r\n\r\nconst handleDragover = (e) => {\r\n  e.dataTransfer.dropEffect = 'copy'\r\n}\r\n\r\n// 点击上传事件\r\nconst upload = (file) => {\r\n  excelUploadInput.value.value = null\r\n\r\n  if (!props.beforeUpload) {\r\n    parseData(file)\r\n    return\r\n  }\r\n\r\n  const before = props.beforeUpload(file)\r\n  if (before) {\r\n    parseData(file)\r\n  }\r\n}\r\n\r\n// 解析excel文件数据\r\nconst parseData = (file) => {\r\n  loading.value = true\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader()\r\n\r\n    // 读取操作完成时触发\r\n    reader.onload = (e) => {\r\n      // 获取数据\r\n      const data = e.target.result\r\n      // XLSX对数据解析\r\n      const workbook = XLSX.read(data, { type: 'array' })\r\n      // 读取第一张表格名称\r\n      const firstSheetName = workbook.SheetNames[0]\r\n      // 读取第一张表格数据\r\n      const workSheet = workbook.Sheets[firstSheetName]\r\n      // 解析数据表头\r\n      const header = getHeaderRow(workSheet)\r\n      // 解析数据体\r\n      const results = XLSX.utils.sheet_to_json(workSheet)\r\n      // 传入解析后的数据\r\n      generateData({ header, results })\r\n      // 处理loading\r\n      loading.value = false\r\n      // 成功回调\r\n      resolve()\r\n    }\r\n\r\n    reader.readAsArrayBuffer(file)\r\n  })\r\n}\r\n\r\n// 根据导入内容，生成数据\r\nconst generateData = (excelData) => {\r\n  props.onSuccess && props.onSuccess(excelData)\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"upload-excel\">\r\n    <div class=\"btn-upload\">\r\n      <el-button :loading=\"loading\" type=\"primary\" @click=\"handleUpload\">\r\n        {{ $t('msg.uploadExcel.upload') }}\r\n      </el-button>\r\n    </div>\r\n    <input\r\n      class=\"excel-upload-input\"\r\n      ref=\"excelUploadInput\"\r\n      type=\"file\"\r\n      accept=\".xlsx,.xls\"\r\n      @change=\"handleChange\"\r\n    />\r\n\r\n    <!-- 拖拽 -->\r\n    <div\r\n      class=\"drop\"\r\n      @drop.stop.prevent=\"handleDrop\"\r\n      @dragover=\"handleDragover\"\r\n      @dragenter=\"handleDragover\"\r\n    >\r\n      <el-icon>\r\n        <UploadFilled />\r\n      </el-icon>\r\n      <span>{{ $t('msg.uploadExcel.drop') }}</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n.upload-excel {\r\n  display: flex;\r\n  justify-content: center;\r\n  margin-top: 100px;\r\n  .excel-upload-input {\r\n    display: none;\r\n    z-index: -999;\r\n  }\r\n  .btn-upload,\r\n  .drop {\r\n    border: 1px dashed #bbb;\r\n    width: 350px;\r\n    height: 160px;\r\n    text-align: center;\r\n    line-height: 160px;\r\n  }\r\n  .drop {\r\n    line-height: 60px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n    color: #bbb;\r\n    ::v-deep .el-icon {\r\n      font-size: 60px;\r\n      display: block;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=431ff7c6&lang=scss&scoped=true\"\n\nimport exportComponent from \"E:\\\\项目\\\\后台管理项目\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-431ff7c6\"]])\n\nexport default __exports__","<script setup>\r\nimport { formatData, USER_RELATIONS } from './utils'\r\nimport { userBatchImport } from '@/api/user-manage'\r\nimport UploadExcel from '@/components/UploadExcel/index.vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { useRouter } from 'vue-router'\r\n\r\nconst i18n = useI18n()\r\nconst router = useRouter()\r\nconst onSuccess = async ({ results }) => {\r\n  const updateData = generateData(results)\r\n  await userBatchImport(updateData)\r\n  ElMessage.success(results.length + i18n.t('msg.excel.importSuccess'))\r\n  router.push('/user/manage')\r\n}\r\n\r\nconst generateData = (results) => {\r\n  const arr = []\r\n  results.forEach((item) => {\r\n    const userInfo = {}\r\n\r\n    Object.keys(item).forEach((key) => {\r\n      if (USER_RELATIONS[key] === 'openTime') {\r\n        userInfo[USER_RELATIONS[key]] = formatData(item[key])\r\n        return\r\n      }\r\n      userInfo[USER_RELATIONS[key]] = item[key]\r\n    })\r\n\r\n    arr.push(userInfo)\r\n  })\r\n\r\n  return arr\r\n}\r\n</script>\r\n\r\n<template>\r\n  <UploadExcel :onSuccess=\"onSuccess\"></UploadExcel>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"sourceRoot":""}